# https://www.digitalocean.com/community/tutorials/how-to-self-host-reviewninja-on-digitalocean-using-docker-and-coreos

version: '3'
services:
  api:
    build:
      context: ./
      dockerfile: micro-chimp.Dockerfile
      args:
        SITE_NAMES_FILE: site_names.yml
    image: blainehansen:micro-chimp
    links:
      - database
    ports:
      - "5050:5050"
    # volumes:
    #   - ./.configs/.env.launch.dev.sh:/env/.env
    #   - ./.configs/.keys.go.sh:/keys/.keys
    #   - ./.configs/.keys.go-db.txt:/keys/.db-key
    tty: true

  database:
    build:
      context: ./
      dockerfile: micro-chimp-postgres.Dockerfile
    image: blainehansen:micro-chimp/postgres
    environment:
      - POSTGRES_DB=database
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=asdf
    ports:
      - "5432:5432"
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
      # - ./.configs/.keys.go-db.txt:/keys/.go-db-key
    command: postgres -c 'max_wal_size=2GB'
